<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Order ‚Äì Ghar ka Khana</title>
  <meta name="description" content="Complete your order for delicious homestyle pure veg meals from Ghar ka Khana.">
  <link rel="icon" href="./images/logo.jpeg" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script>tailwind.config={theme:{extend:{colors:{brand:'#ff6b35',brand2:'#2a9d8f'}}}};</script>
  <script>window.CART_KEY='gkk_cart_v1';</script>
</head>
<body class="bg-white text-gray-900">
  <header class="sticky top-0 z-30 bg-white/90 backdrop-blur border-b border-gray-200 shadow-sm">
    <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
      <a href="./index.html" class="flex items-center gap-3">
        <img src="./images/logo.jpeg" class="w-10 h-10" alt="Ghar ka Khana" />
        <span class="font-extrabold text-xl text-gray-900">Ghar ka Khana</span>
      </a>
      <nav class="flex items-center gap-6 font-semibold text-gray-700">
        <a class="hover:text-brand transition-colors hidden sm:inline" href="./index.html">Home</a>
        <a class="hover:text-brand transition-colors" href="./menu.html">Menu</a>
      </nav>
    </div>
  </header>

  <main class="max-w-6xl mx-auto px-4 py-8">
    <div class="grid lg:grid-cols-2 gap-8">
      <section>
        <div class="bg-white rounded-2xl shadow-sm border border-gray-200 p-6">
          <h1 class="text-2xl md:text-3xl font-extrabold text-gray-900 mb-4">Your Cart</h1>
          <div id="cart-list" class="space-y-3 mb-6">
            <div class="text-center py-8 text-gray-500"><div class="text-5xl mb-3">üõí</div><p class="font-semibold">Loading your cart...</p></div>
          </div>
          <div id="empty-cart" class="hidden text-center py-12">
            <div class="text-6xl mb-4">üçΩÔ∏è</div>
            <h3 class="text-xl font-bold text-gray-700 mb-2">Your cart is empty</h3>
            <p class="text-gray-500 mb-4">Add some delicious items from our menu</p>
            <a href="./menu.html" class="inline-block px-6 py-3 rounded-xl bg-brand text-white font-bold hover:bg-orange-600 transition-all">Browse Menu</a>
          </div>
          <div id="cart-summary" class="border-t border-gray-200 pt-4 hidden">
            <div class="flex justify-between items-center text-lg mb-2"><span class="text-gray-600">Subtotal</span><span class="font-bold">‚Çπ<span id="cart-subtotal">0</span></span></div>
            <div class="flex justify-between items-center text-lg mb-2"><span class="text-gray-600">Delivery Fee</span><span class="font-bold text-green-600">FREE</span></div>
            <div class="flex justify-between items-center text-xl md:text-2xl font-extrabold text-gray-900 pt-3 border-t border-gray-200"><span>Total</span><span class="text-brand">‚Çπ<span id="cart-total">0</span></span></div>
          </div>
        </div>
      </section>

      <section>
        <div class="bg-white rounded-2xl shadow-sm border border-gray-200 p-6">
          <h2 class="text-2xl md:text-3xl font-extrabold text-gray-900 mb-4">Delivery Details</h2>
          <form id="order-form" class="space-y-4">
            <div><label class="block text-sm font-semibold text-gray-700 mb-1">Full Name *</label>
              <input type="text" name="name" required placeholder="Enter your name" class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-brand focus:outline-none transition-colors"/></div>
            <div><label class="block text-sm font-semibold text-gray-700 mb-1">Phone Number *</label>
              <input type="tel" name="phone" required placeholder="+91 XXXXXXXXXX" pattern="[0-9+\s-]+" class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-brand focus:outline-none transition-colors"/></div>
            <div><label class="block text-sm font-semibold text-gray-700 mb-1">Delivery Address *</label>
              <textarea name="address" required rows="3" placeholder="Enter complete delivery address" class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-brand focus:outline-none resize-none transition-colors"></textarea></div>
            <div><label class="block text-sm font-semibold text-gray-700 mb-1">Payment Method *</label>
              <select name="paymentMethod" required class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-brand focus:outline-none transition-colors">
                <option value="Cash">Cash on Delivery (COD)</option><option value="UPI">UPI Payment</option><option value="Card">Debit/Credit Card</option>
              </select></div>
            <div><label class="block text-sm font-semibold text-gray-700 mb-1">Special Instructions (Optional)</label>
              <textarea name="notes" rows="2" placeholder="Any special instructions for delivery or preparation" class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-brand focus:outline-none resize-none transition-colors"></textarea></div>
            <button type="submit" id="place-order-btn" class="w-full px-6 py-4 rounded-xl bg-gradient-to-r from-brand to-orange-500 text-white font-bold shadow-lg hover:shadow-xl transition-all text-lg">Place Order</button>
            <div id="order-status" class="hidden p-4 rounded-xl"></div>
          </form>

          <div class="mt-6 pt-6 border-t border-gray-200 text-center">
            <p class="text-sm text-gray-600 mb-3">Or order directly via WhatsApp</p>
            <a href="https://wa.me/919205920608" target="_blank" class="inline-flex items-center justify-center gap-2 w-full px-6 py-3 rounded-xl border-2 border-brand2 text-brand2 font-bold hover:bg-brand2 hover:text-white transition-all">WhatsApp Order</a>
          </div>
        </div>
      </section>
    </div>

    <div id="success-modal" class="hidden fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4">
      <div class="bg-white rounded-3xl shadow-2xl max-w-md w-full p-8 text-center">
        <div class="text-6xl mb-4">‚úÖ</div>
        <h3 class="text-2xl font-extrabold text-gray-900 mb-2">Order Placed Successfully!</h3>
        <p class="text-gray-600 mb-4">Your order ID: <span id="order-id" class="font-bold text-brand"></span></p>
        <p class="text-sm text-gray-500 mb-6">We'll prepare your meal with love and deliver it fresh!</p>
        <div class="space-y-3">
          <a href="#" id="wa-order-link" target="_blank" class="flex items-center justify-center gap-2 w-full px-6 py-3 rounded-xl bg-brand2 text-white font-bold hover:bg-green-700 transition-all">üü¢ Confirm on WhatsApp</a>
          <button id="close-modal-btn" class="w-full px-6 py-3 rounded-xl border-2 border-gray-300 text-gray-700 font-bold hover:bg-gray-50 transition-all">Close</button>
        </div>
      </div>
    </div>
  </main>

  <footer class="border-t border-gray-200 mt-16 bg-gray-50">
    <div class="max-w-6xl mx-auto px-4 py-8">
      <div class="flex flex-wrap items-center justify-between gap-4 text-sm text-gray-600">
        <p class="font-medium">¬© <span id="year"></span> Ghar ka Khana ‚Ä¢ Pure Veg Homestyle Cloud Kitchen</p>
        <p>Payment ‚Ä¢ Cash/UPI Accepted</p>
      </div>
    </div>
  </footer>

  <script src="./js/main.js"></script>
  <script src="./js/order.js"></script>

  <script>
    (function(){
      const CART_KEY = window.CART_KEY || 'gkk_cart_v1';
      const ORDERS_KEY = 'gkk_orders_v1';
      const WA_NUMBER = '919205920608';

      const els = {
        list: document.getElementById('cart-list'),
        empty: document.getElementById('empty-cart'),
        sum: document.getElementById('cart-summary'),
        sub: document.getElementById('cart-subtotal'),
        tot: document.getElementById('cart-total'),
        form: document.getElementById('order-form'),
        status: document.getElementById('order-status'),
        modal: document.getElementById('success-modal'),
        orderId: document.getElementById('order-id'),
        waLink: document.getElementById('wa-order-link'),
        close: document.getElementById('close-modal-btn')
      };

      const fmt = n => (Math.round((+n||0)*100)/100).toFixed(0);
      const read = (k, d=[]) => { try { return JSON.parse(localStorage.getItem(k) || JSON.stringify(d)); } catch { return d; } };
      const write = (k,v) => localStorage.setItem(k, JSON.stringify(v));
      const readCart = () => read(CART_KEY, []);
      const writeCart = v => write(CART_KEY, v);
      const subtotal = cart => cart.reduce((s,it)=> s + (+it.price||0) * (+it.qty||0), 0);

      function rowHTML(it){
        const line = (+it.price||0) * (+it.qty||0);
        const img = it.img ? (it.img.startsWith('http') ? it.img : `./${it.img.replace(/^\.?\/*/,'')}`) :
                   (it.id ? `./images/${it.id}.jpeg` : './images/placeholder.jpeg');
        return `<div class="flex items-center gap-4 p-3 rounded-xl border border-gray-200">
          <img src="${img}" alt="${it.name}" class="w-16 h-16 rounded-lg object-cover" onerror="this.onerror=null;this.src='./images/placeholder.jpeg';">
          <div class="flex-1"><div class="font-bold">${it.name}</div><div class="text-sm text-gray-500">‚Çπ${fmt(it.price)} each</div></div>
          <div class="flex items-center gap-2">
            <button class="qty-btn px-3 py-2 rounded-lg border text-gray-700" data-id="${it.id||it.name}" data-delta="-1">‚àí</button>
            <span class="w-8 text-center font-bold">${it.qty}</span>
            <button class="qty-btn px-3 py-2 rounded-lg border text-gray-700" data-id="${it.id||it.name}" data-delta="1">+</button>
          </div>
          <div class="w-20 text-right font-extrabold">‚Çπ${fmt(line)}</div>
          <button class="remove-btn ml-2 text-red-600 hover:underline" data-id="${it.id||it.name}">Remove</button>
        </div>`;
      }

      function renderCart(){
        const cart = readCart();
        if(!cart.length){
          els.list.innerHTML=''; els.empty.classList.remove('hidden'); els.sum.classList.add('hidden');
          els.sub.textContent='0'; els.tot.textContent='0'; return;
        }
        els.empty.classList.add('hidden'); els.sum.classList.remove('hidden');
        els.list.innerHTML = cart.map(rowHTML).join('');
        const s = subtotal(cart); els.sub.textContent = fmt(s); els.tot.textContent = fmt(s);

        els.list.querySelectorAll('.qty-btn').forEach(b => b.addEventListener('click', e=>{
          const id=e.currentTarget.dataset.id, d=+e.currentTarget.dataset.delta;
          const c=readCart(); const it=c.find(x=>String(x.id||x.name)===String(id)); if(!it) return;
          const q=Math.max(0,(+it.qty||1)+d); if(q===0) c.splice(c.indexOf(it),1); else it.qty=q; writeCart(c); renderCart();
        }));
        els.list.querySelectorAll('.remove-btn').forEach(b => b.addEventListener('click', e=>{
          const id=e.currentTarget.dataset.id; writeCart(readCart().filter(x=>String(x.id||x.name)!==String(id))); renderCart();
        }));
      }

      // ensure calculation updates properly
      document.addEventListener('DOMContentLoaded', renderCart);
      window.addEventListener('focus', renderCart);
      window.addEventListener('storage', e => { if(e.key===CART_KEY) renderCart(); });

      // Place order
      els.form.addEventListener('submit', (e)=>{
        e.preventDefault();
        const cart = readCart();
        if(!cart.length){
          els.status.className='mt-3 p-4 rounded-xl bg-red-50 text-red-700';
          els.status.textContent='Your cart is empty. Please add items from the menu.'; els.status.classList.remove('hidden'); return;
        }
        const fd = Object.fromEntries(new FormData(els.form).entries());
        if(!fd.name || !fd.phone || !fd.address || !fd.paymentMethod){
          els.status.className='mt-3 p-4 rounded-xl bg-red-50 text-red-700';
          els.status.textContent='Please fill all required fields.'; els.status.classList.remove('hidden'); return;
        }
        const order = {
          id: 'ORD' + Date.now().toString().slice(-5),
          createdAt: new Date().toISOString(),
          customer: { name: fd.name, phone: fd.phone, address: fd.address },
          items: cart,
          total: subtotal(cart),
          paymentMethod: fd.paymentMethod,
          notes: fd.notes || '',
          status: 'PLACED'
        };
        const orders = read('gkk_orders_v1', []); orders.unshift(order); write('gkk_orders_v1', orders);
        const href = `https://wa.me/${WA_NUMBER}?text=${encodeURIComponent('Order ID: '+order.id+'\nTotal: ‚Çπ'+order.total)}`;
        els.orderId.textContent = order.id;
        els.waLink.href = href;
        els.modal.classList.remove('hidden');
        writeCart([]); renderCart(); els.form.reset(); els.status.classList.add('hidden');
      });

      els.close.addEventListener('click', ()=>els.modal.classList.add('hidden'));
    })();
  </script>
</body>
</html>
